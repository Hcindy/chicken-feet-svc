(self.webpackChunkchicken_feet_web=self.webpackChunkchicken_feet_web||[]).push([[3464],{3464:(e,n,t)=>{"use strict";t.r(n),t.d(n,{NewGamePageModule:()=>f});var i=t(8583),o=t(665),a=t(3083),s=t(8136),g=t(1406),r=t(205),u=t(5917),m=t(9773),l=t(639),h=t(1841);let c=(()=>{class e{constructor(e){this.http=e,this.ok=g.Z.ok}postGame(e){return this.http.post("games",e).pipe((0,m.zg)(e=>e.result<this.ok?(0,r._)(e.message):(0,u.of)(e.result)))}}return e.\u0275fac=function(n){return new(n||e)(l.LFG(h.eN))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac}),e})();function d(e,n){if(1&e&&(l.TgZ(0,"ion-item"),l.TgZ(1,"ion-label",16),l._uU(2),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(2),l.Oqu(e.action.message)}}function Z(e,n){if(1&e){const e=l.EpF();l.TgZ(0,"ion-row"),l.TgZ(1,"ion-col",11),l.TgZ(2,"ion-item"),l.TgZ(3,"ion-label",7),l._uU(4),l.qZA(),l.TgZ(5,"ion-input",17,18),l.NdJ("ngModelChange",function(n){return l.CHM(e).$implicit.name=n})("ionChange",function(){const n=l.CHM(e).index;return l.oxw().onIonChange(n)}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(7,"ion-col",11),l.TgZ(8,"ion-item"),l.TgZ(9,"ion-label",7),l._uU(10,"\u5956\u9879\u6570\u91cf"),l.qZA(),l.TgZ(11,"ion-input",19,20),l.NdJ("ngModelChange",function(n){return l.CHM(e).$implicit.amount=n})("ionChange",function(){const n=l.CHM(e).index;return l.oxw().onIonChange(n)}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(13,"ion-col",11),l.TgZ(14,"ion-item"),l.TgZ(15,"ion-label",7),l._uU(16,"\u5956\u9879\u9762\u989d"),l.qZA(),l.TgZ(17,"ion-input",21,22),l.NdJ("ngModelChange",function(n){return l.CHM(e).$implicit.worth=n})("ionChange",function(){const n=l.CHM(e).index;return l.oxw().onIonChange(n)}),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=n.$implicit,t=n.index,i=l.oxw();l.xp6(4),l.hij("",t+1,"\u3001\u5956\u9879\u540d\u79f0"),l.xp6(1),l.Q6J("ngModel",e.name)("pattern",i.bonusNameReg),l.xp6(6),l.Q6J("ngModel",e.amount)("pattern",i.bonusAmountReg),l.xp6(6),l.Q6J("ngModel",e.worth)("pattern",i.bonusWorthReg)}}const T=function(){return["/manage-game"]},p=[{path:"",component:(()=>{class e{constructor(e,n){this.router=e,this.newGameService=n,this.gameNameReg=g.Z.gameNameReg,this.bonusNameReg=g.Z.bonusNameReg,this.bonusAmountReg=g.Z.bonusAmountReg,this.bonusWorthReg=g.Z.bonusWorthReg,this.bnreg=new RegExp(this.bonusNameReg),this.bareg=new RegExp(this.bonusAmountReg),this.bwreg=new RegExp(this.bonusWorthReg),this.action={loading:!1,message:""},this.game={id:"",name:"",bonuses:[],participants:[],startTime:null,endTime:null},this.statistic={nameTotal:0,amountTotal:0,worthTotal:0}}ngOnInit(){this.game.startTime=(new Date).getTime()+18e4,this.game.endTime=this.game.startTime+6e5,this.addNullItem()}getIsoStartTime(){return new Date(this.game.startTime).toISOString()}getIsoEndTime(){return new Date(this.game.endTime).toISOString()}onStartTimeChange(e){this.game.startTime=new Date(e).getTime()}onEndTimeChange(e){this.game.endTime=new Date(e).getTime()}addNullItem(){this.game.bonuses.push({name:null,amount:null,worth:null})}onIonChange(e){if(e===this.game.bonuses.length-1){const n=this.game.bonuses[e];null==n.name&&null==n.amount&&null==n.worth||this.addNullItem()}else if(e===this.game.bonuses.length-2){const n=this.game.bonuses[e];""!==n.name&&null!=n.name||""!=`${n.amount}`&&null!=n.amount||""!=`${n.worth}`&&null!=n.worth||this.game.bonuses.pop()}this.statistic.nameTotal=0,this.statistic.amountTotal=0,this.statistic.worthTotal=0;const n=this.game.bonuses.length-1;for(let t=0;t<n;t++)this.checkInvalidate(this.bnreg,this.game.bonuses[t].name)||this.checkInvalidate(this.bareg,this.game.bonuses[t].amount)||this.checkInvalidate(this.bwreg,this.game.bonuses[t].worth)||(this.statistic.nameTotal+=1,this.statistic.amountTotal+=1*this.game.bonuses[t].amount,this.statistic.worthTotal+=this.game.bonuses[t].amount*this.game.bonuses[t].worth)}checkInvalidate(e,n){return!e.test(n)}submit(){if(this.action.loading=!0,this.action.message="",this.checkInvalidate(new RegExp(this.gameNameReg),this.game.name))return void(this.action.loading=!1);const e=this.game.bonuses.length-1,n=[];for(let o=0;o<e;o++){if(this.checkInvalidate(this.bnreg,this.game.bonuses[o].name))return void(this.action.loading=!1);if(this.checkInvalidate(this.bareg,this.game.bonuses[o].amount))return void(this.action.loading=!1);if(this.checkInvalidate(this.bwreg,this.game.bonuses[o].worth))return void(this.action.loading=!1);n.push(this.game.bonuses[o])}if(this.game.startTime>this.game.endTime)return void(this.action.loading=!1);const t=(new Date).getTime();if(this.game.startTime<t)return void(this.action.loading=!1);const i=this.game;i.bonuses=n,this.newGameService.postGame(i).subscribe(e=>this.router.navigate(["/manage-game"]),e=>{"exist"===e?this.action.message="\u5df2\u5b58\u5728\u76f8\u540c\u7684\u6e38\u620f":(this.action.message="\u521b\u5efa\u65b0\u6e38\u620f\u5931\u8d25",console.error(e))})}}return e.\u0275fac=function(n){return new(n||e)(l.Y36(s.F0),l.Y36(c))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-new-game"]],features:[l._Bn([c])],decls:43,vars:12,consts:[["mode","ios"],["slot","start"],[3,"routerLink"],[1,"ion-text-center"],["slot","end"],[3,"disabled","click"],[4,"ngIf"],["position","floating"],["autofocus","","clearInput","","placeholder","8\u4f4d\u4ee5\u5185\u7684\u4e2d\u6587\u3001\u82f1\u6587\u6216\u6570\u5b57","name","name",3,"ngModel","pattern","ngModelChange"],["name","ngModel"],[4,"ngFor","ngForOf"],["size","12","size-lg",""],["color","primary"],["displayFormat","YYYY-MM-DD HH:mm",3,"value","ionChange"],["startTime",""],["endTime",""],["color","danger"],["clearInput","","placeholder","8\u4f4d\u4ee5\u5185\u7684\u4e2d\u6587\u3001\u82f1\u6587\u6216\u6570\u5b57","name","bonuseName",3,"ngModel","pattern","ngModelChange","ionChange"],["bonuseName","ngModel"],["clearInput","","placeholder","\u5927\u4e8e0\u7684\u6574\u6570","name","bonuseAmount",3,"ngModel","pattern","ngModelChange","ionChange"],["bonuseAmount","ngModel"],["clearInput","","placeholder","\u6700\u591a\u4e24\u4f4d\u5c0f\u6570","name","bonuseWorth",3,"ngModel","pattern","ngModelChange","ionChange"],["bonuseWorth","ngModel"]],template:function(e,n){if(1&e){const e=l.EpF();l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar",0),l.TgZ(2,"ion-buttons",1),l.TgZ(3,"ion-button",2),l._uU(4,"\u53d6\u6d88"),l.qZA(),l.qZA(),l.TgZ(5,"ion-title",3),l._uU(6,"\u65b0\u6e38\u620f"),l.qZA(),l.TgZ(7,"ion-buttons",4),l.TgZ(8,"ion-button",5),l.NdJ("click",function(){return n.submit()}),l._uU(9,"\u63d0\u4ea4"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(10,"ion-content"),l.YNc(11,d,3,1,"ion-item",6),l.TgZ(12,"ion-item"),l.TgZ(13,"ion-label",7),l._uU(14,"\u6e38\u620f\u540d\u79f0"),l.qZA(),l.TgZ(15,"ion-input",8,9),l.NdJ("ngModelChange",function(e){return n.game.name=e}),l.qZA(),l.qZA(),l.TgZ(17,"ion-grid"),l.YNc(18,Z,19,7,"ion-row",10),l.TgZ(19,"ion-row"),l.TgZ(20,"ion-col",11),l.TgZ(21,"ion-item"),l.TgZ(22,"ion-label",12),l._uU(23),l.qZA(),l.qZA(),l.qZA(),l.TgZ(24,"ion-col",11),l.TgZ(25,"ion-item"),l.TgZ(26,"ion-label",12),l._uU(27),l.qZA(),l.qZA(),l.qZA(),l.TgZ(28,"ion-col",11),l.TgZ(29,"ion-item"),l.TgZ(30,"ion-label",12),l._uU(31),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(32,"ion-list"),l.TgZ(33,"ion-item"),l.TgZ(34,"ion-label",7),l._uU(35,"\u5f00\u59cb\u65f6\u95f4"),l.qZA(),l.TgZ(36,"ion-datetime",13,14),l.NdJ("ionChange",function(){l.CHM(e);const t=l.MAs(37);return n.onStartTimeChange(t.value)}),l.qZA(),l.qZA(),l.TgZ(38,"ion-item"),l.TgZ(39,"ion-label",7),l._uU(40,"\u7ed3\u675f\u65f6\u95f4"),l.qZA(),l.TgZ(41,"ion-datetime",13,15),l.NdJ("ionChange",function(){l.CHM(e);const t=l.MAs(42);return n.onEndTimeChange(t.value)}),l.qZA(),l.qZA(),l.qZA(),l.qZA()}2&e&&(l.xp6(3),l.Q6J("routerLink",l.DdM(11,T)),l.xp6(5),l.Q6J("disabled",n.action.loading),l.xp6(3),l.Q6J("ngIf",n.action.message.length),l.xp6(4),l.Q6J("ngModel",n.game.name)("pattern",n.gameNameReg),l.xp6(3),l.Q6J("ngForOf",n.game.bonuses),l.xp6(5),l.hij("\u540d\u79f0\u7edf\u8ba1 ",n.statistic.nameTotal,""),l.xp6(4),l.hij("\u6570\u91cf\u7edf\u8ba1 ",n.statistic.amountTotal,""),l.xp6(4),l.hij("\u9762\u989d\u7edf\u8ba1 ",n.statistic.worthTotal,""),l.xp6(5),l.Q6J("value",n.getIsoStartTime()),l.xp6(5),l.Q6J("value",n.getIsoEndTime()))},directives:[a.Gu,a.sr,a.Sm,a.YG,a.YI,s.rH,a.wd,a.W2,i.O5,a.Ie,a.Q$,a.pK,a.j9,o.JJ,o.On,o.c5,a.jY,i.sg,a.Nd,a.wI,a.q_,a.x4,a.QI],styles:["ion-grid[_ngcontent-%COMP%]{--ion-grid-padding:0}ion-col[_ngcontent-%COMP%]{--ion-grid-column-padding:0}"]}),e})()}];let b=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({imports:[[s.Bz.forChild(p)],s.Bz]}),e})();var A=t(6538);let f=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({providers:[{provide:h.TP,useClass:A.Q,multi:!0}],imports:[[i.ez,o.u5,h.JF,a.Pc,b]]}),e})()}}]);